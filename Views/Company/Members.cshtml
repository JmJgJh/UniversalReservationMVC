@using UniversalReservationMVC.Models
@model List<CompanyMember>
@{
    ViewData["Title"] = "Cz≈Çonkowie firmy";
    var company = ViewBag.Company as Company;
}

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col">
            <h2>üë• Cz≈Çonkowie firmy: @company?.Name</h2>
            <p class="text-muted">Dodawaj u≈ºytkownik√≥w po adresie email. U≈ºytkownik mo≈ºe nale≈ºeƒá do wielu firm.</p>
        </div>
        <div class="col-auto">
            <a asp-action="Dashboard" class="btn btn-outline-secondary">Powr√≥t</a>
        </div>
    </div>

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }

    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">‚ûï Dodaj u≈ºytkownika do firmy</h5>
        </div>
        <div class="card-body">
            <form method="post" asp-action="AddMember">
                @Html.AntiForgeryToken()
                <div class="row g-3 align-items-end">
                    <div class="col-md-4">
                        <label class="form-label">Email u≈ºytkownika</label>
                        <input type="email" name="email" class="form-control" required placeholder="uzytkownik@example.com" />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Rola</label>
                        <select name="role" class="form-select">
                            <option value="Employee">Pracownik</option>
                            <option value="Manager">Manager</option>
                            <option value="Viewer">PodglƒÖd</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Uprawnienia</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="canManageResources" id="permRes" />
                            <label class="form-check-label" for="permRes">ZarzƒÖdzaj zasobami</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="canManageReservations" id="permResv" />
                            <label class="form-check-label" for="permResv">ZarzƒÖdzaj rezerwacjami</label>
                        </div>
                    </div>
                    <div class="col-md-2 d-grid">
                        <button type="submit" class="btn btn-success">Dodaj</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-light">
            <h5 class="mb-0">Lista cz≈Çonk√≥w</h5>
        </div>
        <div class="card-body">
            @if (Model != null && Model.Count > 0)
            {
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead>
                            <tr>
                                <th>U≈ºytkownik</th>
                                <th>Email</th>
                                <th>Rola</th>
                                <th>Zasoby</th>
                                <th>Rezerwacje</th>
                                <th>Do≈ÇƒÖczy≈Ç</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                        @foreach (var m in Model)
                        {
                            <tr>
                                <td>@(m.User?.FirstName) @(m.User?.LastName)</td>
                                <td>@m.User?.Email</td>
                                <td><span class="badge bg-secondary">@m.Role</span></td>
                                <td>@(m.CanManageResources ? "‚úÖ" : "‚Äî")</td>
                                <td>@(m.CanManageReservations ? "‚úÖ" : "‚Äî")</td>
                                <td>@m.JoinedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                                <td class="text-end">
                                    <form method="post" asp-action="RemoveMember" class="d-inline">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="companyId" value="@m.CompanyId" />
                                        <input type="hidden" name="userId" value="@m.UserId" />
                                        <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('UsunƒÖƒá u≈ºytkownika?');">Usu≈Ñ</button>
                                    </form>
                                </td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="alert alert-info mb-0">Brak przypisanych u≈ºytkownik√≥w.</div>
            }
        </div>
    </div>
</div>
